TAP version 14
# Subtest: GET /api/analytics/1rm-progression - T017
{"level":30,"time":1759673939789,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"GET","url":"/api/analytics/1rm-progression?exercise_id=1&start_date=2025-01-01&end_date=2025-01-31","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
    # Subtest: returns 401 unauthorized without JWT
        ok 1 - should return 401 without auth token
        1..1
    ok 1 - returns 401 unauthorized without JWT # time=383.101ms
    
{"level":30,"time":1759673939802,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":401},"responseTime":11.131441995501518,"msg":"request completed"}
{"level":30,"time":1759673939814,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940135,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":201},"responseTime":320.66956700384617,"msg":"request completed"}
    # Subtest: validates query parameters and response schema
        # Subtest: requires exercise_id query param
            ok 1 - should return 400 without exercise_id
            1..1
        ok 1 - requires exercise_id query param # time=4.344ms
        
        # Subtest: requires start_date query param
            ok 1 - should return 400 without start_date
            1..1
        ok 2 - requires start_date query param # time=1.506ms
        
        # Subtest: requires end_date query param
            ok 1 - should return 400 without end_date
            1..1
        ok 3 - requires end_date query param # time=2.076ms
        
        # Subtest: returns valid response schema with all params
            ok 1 - should return 200 with valid params
            ok 2 - response should be an array
            1..2
        ok 4 - returns valid response schema with all params # time=4.424ms
        
        1..4
    ok 2 - validates query parameters and response schema # time=338.208ms
    
    1..2
ok 1 - GET /api/analytics/1rm-progression - T017 # time=824.72ms

# Subtest: GET /api/analytics/volume-trends - T018
{"level":30,"time":1759673940359,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"GET","url":"/api/analytics/volume-trends?muscle_group=chest&start_date=2025-01-01&end_date=2025-01-31","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
    # Subtest: returns 401 unauthorized without JWT
        ok 1 - should return 401 without auth token
        1..1
    ok 1 - returns 401 unauthorized without JWT # time=173.152ms
    
{"level":30,"time":1759673940137,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"GET","url":"/api/analytics/1rm-progression?start_date=2025-01-01&end_date=2025-01-31","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940138,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":400},"err":{"type":"Error","message":"querystring must have required property 'exercise_id'","stack":"Error: querystring must have required property 'exercise_id'\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:178:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at handleRequest (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:24:5)\n    at runPreParsing (/home/asigator/fitness2025/backend/node_modules/fastify/lib/route.js:613:5)\n    at next (/home/asigator/fitness2025/backend/node_modules/fastify/lib/hooks.js:233:9)\n    at /home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:204:12\n    at resolveOriginOption (/home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:162:129)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"exercise_id"},"message":"must have required property 'exercise_id'"}],"validationContext":"querystring"},"msg":"querystring must have required property 'exercise_id'"}
{"level":30,"time":1759673940140,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":400},"responseTime":3.081206001341343,"msg":"request completed"}
{"level":30,"time":1759673940142,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","req":{"method":"GET","url":"/api/analytics/1rm-progression?exercise_id=1&end_date=2025-01-31","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940142,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":400},"err":{"type":"Error","message":"querystring must have required property 'start_date'","stack":"Error: querystring must have required property 'start_date'\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:178:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at handleRequest (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:24:5)\n    at runPreParsing (/home/asigator/fitness2025/backend/node_modules/fastify/lib/route.js:613:5)\n    at next (/home/asigator/fitness2025/backend/node_modules/fastify/lib/hooks.js:233:9)\n    at /home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:204:12\n    at resolveOriginOption (/home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:162:129)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"start_date"},"message":"must have required property 'start_date'"}],"validationContext":"querystring"},"msg":"querystring must have required property 'start_date'"}
{"level":30,"time":1759673940143,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":400},"responseTime":0.5331720039248466,"msg":"request completed"}
{"level":30,"time":1759673940144,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","req":{"method":"GET","url":"/api/analytics/1rm-progression?exercise_id=1&start_date=2025-01-01","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940145,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":400},"err":{"type":"Error","message":"querystring must have required property 'end_date'","stack":"Error: querystring must have required property 'end_date'\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:178:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at handleRequest (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:24:5)\n    at runPreParsing (/home/asigator/fitness2025/backend/node_modules/fastify/lib/route.js:613:5)\n    at next (/home/asigator/fitness2025/backend/node_modules/fastify/lib/hooks.js:233:9)\n    at /home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:204:12\n    at resolveOriginOption (/home/asigator/fitness2025/backend/node_modules/@fastify/cors/index.js:162:129)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"end_date"},"message":"must have required property 'end_date'"}],"validationContext":"querystring"},"msg":"querystring must have required property 'end_date'"}
{"level":30,"time":1759673940145,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":400},"responseTime":0.5188539996743202,"msg":"request completed"}
{"level":30,"time":1759673940147,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","req":{"method":"GET","url":"/api/analytics/1rm-progression?exercise_id=1&start_date=2025-01-01&end_date=2025-01-31","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940150,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":200},"responseTime":2.470651000738144,"msg":"request completed"}
{"level":30,"time":1759673940361,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":401},"responseTime":1.019339993596077,"msg":"request completed"}
{"level":30,"time":1759673940364,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940594,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":201},"responseTime":230.61740799993277,"msg":"request completed"}
    # Subtest: validates query parameters and response schema
        # Subtest: accepts requests without muscle_group (returns all muscle groups)
            ok 1 - should return 200 without muscle_group (optional param)
            1..1
        ok 1 - accepts requests without muscle_group (returns all muscle groups) # time=3.623ms
        
        # Subtest: accepts custom weeks parameter
            ok 1 - should return 200 with weeks parameter
            1..1
        ok 2 - accepts custom weeks parameter # time=2.174ms
        
        # Subtest: validates weeks parameter (must be positive)
            ok 1 - should return 400 for negative weeks
            1..1
        ok 3 - validates weeks parameter (must be positive) # time=1.972ms
        
        # Subtest: returns valid response schema with all params
            ok 1 - should return 200 with valid params
            ok 2 - response should have weeks property
            ok 3 - weeks should be an array
            1..3
        ok 4 - returns valid response schema with all params # time=5.394ms
        
        1..4
    ok 2 - validates query parameters and response schema # time=250.667ms
    
    1..2
ok 2 - GET /api/analytics/volume-trends - T018 # time=465.197ms

# Subtest: GET /api/analytics/consistency - T019
{"level":30,"time":1759673940802,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"GET","url":"/api/analytics/consistency","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
    # Subtest: returns 401 unauthorized without JWT
        ok 1 - should return 401 without auth token
        1..1
    ok 1 - returns 401 unauthorized without JWT # time=139.957ms
    
{"level":30,"time":1759673940596,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"GET","url":"/api/analytics/volume-trends","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940597,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":200},"responseTime":1.417996995151043,"msg":"request completed"}
{"level":30,"time":1759673940600,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","req":{"method":"GET","url":"/api/analytics/volume-trends?weeks=12","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940601,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":200},"responseTime":0.9750609993934631,"msg":"request completed"}
{"level":30,"time":1759673940605,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","req":{"method":"GET","url":"/api/analytics/volume-trends?weeks=-5","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940605,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":400},"responseTime":0.556987002491951,"msg":"request completed"}
{"level":30,"time":1759673940608,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","req":{"method":"GET","url":"/api/analytics/volume-trends?muscle_group=chest&weeks=8","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940609,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":200},"responseTime":1.2851580008864403,"msg":"request completed"}
{"level":30,"time":1759673940803,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":401},"responseTime":0.6197749972343445,"msg":"request completed"}
{"level":30,"time":1759673940806,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673941057,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":201},"responseTime":251.05295399576426,"msg":"request completed"}
    # Subtest: validates response schema
        ok 1 - should return 200 with valid auth
        ok 2 - response should be an object
        ok 3 - response should have adherence_rate property
        ok 4 - response should have avg_session_duration property
        ok 5 - response should have total_workouts property
        ok 6 - adherence_rate should be number
        ok 7 - avg_session_duration should be number
        ok 8 - total_workouts should be number
        1..8
    ok 2 - validates response schema # time=258.679ms
    
    1..2
ok 3 - GET /api/analytics/consistency - T019 # time=446.164ms

{"level":30,"time":1759673941058,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"GET","url":"/api/analytics/consistency","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673941059,"pid":406612,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":200},"responseTime":1.2339629977941513,"msg":"request completed"}
1..3
Database connection closed
