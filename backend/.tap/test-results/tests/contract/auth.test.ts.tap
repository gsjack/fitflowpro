TAP version 14
# Subtest: Authentication Endpoints Contract Tests
{"level":30,"time":1759673939874,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940113,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":201},"responseTime":235.9621840044856,"msg":"request completed"}
    # Subtest: POST /api/auth/register
        # Subtest: should register new user with valid data and return 201
            ok 1 - should return 201 Created
            ok 2 - response should contain user_id
            ok 3 - user_id should be a number
            ok 4 - response should contain token
            ok 5 - token should be a string
            ok 6 - token should be a valid JWT
            1..6
        ok 1 - should register new user with valid data and return 201 # time=600.385ms
        
        # Subtest: should validate username is email format
            ok 1 - should return 400 for invalid email format
            ok 2 - response should contain error field
            ok 3 - error should be a string
            1..3
        ok 2 - should validate username is email format # time=5.349ms
        
{"level":30,"time":1759673940128,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940129,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":400},"err":{"type":"Error","message":"body/username must match format \"email\"","stack":"Error: body/username must match format \"email\"\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/username","schemaPath":"#/properties/username/format","keyword":"format","params":{"format":"email"},"message":"must match format \"email\""}],"validationContext":"body"},"msg":"body/username must match format \"email\""}
{"level":30,"time":1759673940131,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":400},"responseTime":3.3567319959402084,"msg":"request completed"}
{"level":30,"time":1759673940134,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should validate password minimum length (8 characters)
            ok 1 - should return 400 for password < 8 chars
            ok 2 - response should contain error field
            1..2
        ok 3 - should validate password minimum length (8 characters) # time=2.922ms
        
{"level":30,"time":1759673940134,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":400},"err":{"type":"Error","message":"body/password must NOT have fewer than 8 characters","stack":"Error: body/password must NOT have fewer than 8 characters\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/password","schemaPath":"#/properties/password/minLength","keyword":"minLength","params":{"limit":8},"message":"must NOT have fewer than 8 characters"}],"validationContext":"body"},"msg":"body/password must NOT have fewer than 8 characters"}
{"level":30,"time":1759673940135,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":400},"responseTime":1.0464380010962486,"msg":"request completed"}
{"level":30,"time":1759673940139,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should validate age range (13-100)
            ok 1 - should return 400 for age < 13
            ok 2 - response should contain error field
            1..2
        ok 4 - should validate age range (13-100) # time=4.164ms
        
{"level":30,"time":1759673940139,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":400},"err":{"type":"Error","message":"body/age must be >= 13","stack":"Error: body/age must be >= 13\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/age","schemaPath":"#/properties/age/minimum","keyword":"minimum","params":{"comparison":">=","limit":13},"message":"must be >= 13"}],"validationContext":"body"},"msg":"body/age must be >= 13"}
{"level":30,"time":1759673940139,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":400},"responseTime":0.8773519992828369,"msg":"request completed"}
{"level":30,"time":1759673940144,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should validate weight_kg range (30-300)
            ok 1 - should return 400 for weight_kg < 30
            ok 2 - response should contain error field
            1..2
        ok 5 - should validate weight_kg range (30-300) # time=3.937ms
        
{"level":30,"time":1759673940145,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":400},"err":{"type":"Error","message":"body/weight_kg must be >= 30","stack":"Error: body/weight_kg must be >= 30\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/weight_kg","schemaPath":"#/properties/weight_kg/minimum","keyword":"minimum","params":{"comparison":">=","limit":30},"message":"must be >= 30"}],"validationContext":"body"},"msg":"body/weight_kg must be >= 30"}
{"level":30,"time":1759673940146,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":400},"responseTime":2.0929469987750053,"msg":"request completed"}
{"level":30,"time":1759673940148,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should validate experience_level enum
            ok 1 - should return 400 for invalid experience_level
            ok 2 - response should contain error field
            1..2
        ok 6 - should validate experience_level enum # time=3.218ms
        
{"level":30,"time":1759673940149,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":400},"err":{"type":"Error","message":"body/experience_level must be equal to one of the allowed values","stack":"Error: body/experience_level must be equal to one of the allowed values\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/experience_level","schemaPath":"#/properties/experience_level/enum","keyword":"enum","params":{"allowedValues":["beginner","intermediate","advanced"]},"message":"must be equal to one of the allowed values"}],"validationContext":"body"},"msg":"body/experience_level must be equal to one of the allowed values"}
{"level":30,"time":1759673940149,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":400},"responseTime":0.7969639971852303,"msg":"request completed"}
{"level":30,"time":1759673940153,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940154,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","res":{"statusCode":409},"responseTime":1.1474990025162697,"msg":"request completed"}
{"level":30,"time":1759673940155,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 409 for duplicate username
            ok 1 - should return 409 for duplicate username
            ok 2 - response should contain error field
            ok 3 - error should be a string
            1..3
        ok 7 - should return 409 for duplicate username # time=5.36ms
        
{"level":30,"time":1759673940156,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","res":{"statusCode":409},"responseTime":0.6227779984474182,"msg":"request completed"}
{"level":30,"time":1759673940163,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940459,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","res":{"statusCode":201},"responseTime":295.7195230051875,"msg":"request completed"}
        # Subtest: should allow registration without optional fields
            ok 1 - should return 201 with only required fields
            ok 2 - response should contain user_id
            ok 3 - response should contain token
            1..3
        ok 8 - should allow registration without optional fields # time=300.894ms
        
        1..8
    ok 1 - POST /api/auth/register # time=941.379ms
    
{"level":30,"time":1759673940470,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940471,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","res":{"statusCode":409},"responseTime":0.8920180052518845,"msg":"request completed"}
{"level":30,"time":1759673940472,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
    # Subtest: POST /api/auth/login
        # Subtest: should login with valid credentials and return 200
{"level":30,"time":1759673940719,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","res":{"statusCode":200},"responseTime":246.97286999970675,"msg":"request completed"}
            ok 1 - should return 200 OK
            ok 2 - response should contain token
            ok 3 - token should be a string
            ok 4 - token should be a valid JWT
            ok 5 - response should contain user object
            ok 6 - user should be an object
            ok 7 - user should have id
            ok 8 - user.id should be a number
            ok 9 - user should have correct username
            ok 10 - user.username should be a string
            ok 11 - user should have created_at timestamp
            ok 12 - user.created_at should be a number (Unix timestamp)
            1..12
        ok 1 - should login with valid credentials and return 200 # time=252.48ms
        
        # Subtest: should return 401 for invalid username
            ok 1 - should return 401 for invalid username
            ok 2 - response should contain error field
            ok 3 - error should be a string
            1..3
        ok 2 - should return 401 for invalid username # time=2.043ms
        
{"level":30,"time":1759673940724,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940724,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","res":{"statusCode":401},"responseTime":0.5915589928627014,"msg":"request completed"}
{"level":30,"time":1759673940727,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940728,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","res":{"statusCode":409},"responseTime":0.6860549971461296,"msg":"request completed"}
{"level":30,"time":1759673940728,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 401 for invalid password
            ok 1 - should return 401 for invalid password
{"level":30,"time":1759673940975,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","res":{"statusCode":401},"responseTime":246.39611800014973,"msg":"request completed"}
            ok 2 - response should contain error field
            ok 3 - error should be a string
            1..3
        ok 3 - should return 401 for invalid password # time=250.886ms
        
        # Subtest: should require both username and password
            ok 1 - should return 400 for missing password
            ok 2 - response should contain error field
            1..2
        ok 4 - should require both username and password # time=3.055ms
        
        1..4
    ok 2 - POST /api/auth/login # time=516.614ms
    
    1..2
ok 1 - Authentication Endpoints Contract Tests # time=1535.174ms

{"level":30,"time":1759673940979,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940979,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","res":{"statusCode":400},"err":{"type":"Error","message":"body must have required property 'password'","stack":"Error: body must have required property 'password'\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"","schemaPath":"#/required","keyword":"required","params":{"missingProperty":"password"},"message":"must have required property 'password'"}],"validationContext":"body"},"msg":"body must have required property 'password'"}
{"level":30,"time":1759673940980,"pid":406618,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","res":{"statusCode":400},"responseTime":0.799128994345665,"msg":"request completed"}
1..1
Database connection closed
