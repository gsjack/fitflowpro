TAP version 14
# Subtest: Program Management Endpoints Contract Tests
{"level":30,"time":1759673939444,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673939739,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":201},"responseTime":289.9319490045309,"msg":"request completed"}
{"level":30,"time":1759673939740,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673939983,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":200},"responseTime":243.30918300151825,"msg":"request completed"}
    # Subtest: GET /api/programs
        # Subtest: should return active program with full structure (200)
            ok 1 - Returns 200 OK
            ok 2 - Program has id
            ok 3 - Program has user_id
            ok 4 - Program belongs to authenticated user
            ok 5 - Program has valid mesocycle_phase
            ok 6 - Program has mesocycle_week
            ok 7 - mesocycle_week is between 1 and 8
            ok 8 - Program has program_days array
            ok 9 - Program has at least one program day
            ok 10 - ProgramDay has id
            ok 11 - ProgramDay has day_name
            ok 12 - ProgramDay has day_of_week
            ok 13 - day_of_week is between 1 and 7
            ok 14 - ProgramDay has exercises array
            ok 15 - ProgramExercise has id
            ok 16 - ProgramExercise has exercise_id
            ok 17 - ProgramExercise has exercise_name
            ok 18 - ProgramExercise has target_sets
            ok 19 - target_sets is between 1 and 10
            ok 20 - ProgramExercise has target_rep_range
            ok 21 - target_rep_range follows format "6-8"
            ok 22 - ProgramExercise has target_rir
            ok 23 - target_rir is between 0 and 4
            ok 24 - ProgramExercise has order_index
            1..24
        ok 1 - should return active program with full structure (200) # time=24.173ms
        
        # Subtest: should return 401 without authentication
            ok 1 - Returns 401 Unauthorized
            ok 2 - Returns error message
            1..2
        ok 2 - should return 401 without authentication # time=1.952ms
        
        # Subtest: should return 404 when user has no active program
            ok 1 - All users get a default program on registration - 404 scenario not applicable # SKIP
            1..1
        ok 3 - should return 404 when user has no active program # time=1.408ms
        
        1..3
    ok 1 - GET /api/programs # time=36.227ms
    
    # Subtest: PATCH /api/programs/:id/advance-phase
        # Subtest: should advance phase automatically (MEV→MAV) (200)
            ok 1 - Returns 200 OK
            ok 2 - Response has previous_phase
            ok 3 - previous_phase is valid
            ok 4 - Response has new_phase
            ok 5 - new_phase is valid
            ok 6 - Response has volume_multiplier
            ok 7 - volume_multiplier is positive
            ok 8 - Response has exercises_updated
            ok 9 - exercises_updated is non-negative
            ok 10 - MEV advances to MAV
            ok 11 - MEV→MAV volume multiplier is ~1.2
            1..11
        ok 1 - should advance phase automatically (MEV→MAV) (200) # time=8.573ms
        
{"level":30,"time":1759673939986,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673939992,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":200},"responseTime":5.309087999165058,"msg":"request completed"}
{"level":30,"time":1759673940014,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940015,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":401},"responseTime":0.8462719991803169,"msg":"request completed"}
{"level":30,"time":1759673940022,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940026,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":200},"responseTime":4.443470001220703,"msg":"request completed"}
{"level":30,"time":1759673940027,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940030,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":200},"responseTime":2.9888059943914413,"msg":"request completed"}
{"level":30,"time":1759673940037,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should advance phase manually to specific target (200)
            ok 1 - Returns 200 OK
            ok 2 - Phase advanced to target mrv
            ok 3 - Has volume_multiplier
            ok 4 - Has exercises_updated
            1..4
        ok 2 - should advance phase manually to specific target (200) # time=5.497ms
        
{"level":30,"time":1759673940039,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","res":{"statusCode":200},"responseTime":2.2823569998145103,"msg":"request completed"}
{"level":30,"time":1759673940043,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940045,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","res":{"statusCode":200},"responseTime":1.7211790010333061,"msg":"request completed"}
{"level":30,"time":1759673940045,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should transition to deload from MRV (200)
            ok 1 - Returns 200 OK
            ok 2 - Previous phase was MRV
            ok 3 - New phase is deload
            ok 4 - Deload reduces volume by ~50%
            1..4
        ok 3 - should transition to deload from MRV (200) # time=6.2ms
        
{"level":30,"time":1759673940047,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","res":{"statusCode":200},"responseTime":1.767764002084732,"msg":"request completed"}
{"level":30,"time":1759673940051,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 400 for invalid phase transition
            ok 1 - Returns 400 Bad Request
            ok 2 - Returns error message
            1..2
        ok 4 - should return 400 for invalid phase transition # time=4.152ms
        
{"level":30,"time":1759673940052,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","res":{"statusCode":400},"err":{"type":"Error","message":"body/target_phase must be equal to one of the allowed values","stack":"Error: body/target_phase must be equal to one of the allowed values\n    at defaultSchemaErrorFormatter (/home/asigator/fitness2025/backend/node_modules/fastify/lib/context.js:114:10)\n    at wrapValidationError (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:249:17)\n    at validate (/home/asigator/fitness2025/backend/node_modules/fastify/lib/validation.js:167:16)\n    at preValidationCallback (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:93:25)\n    at handler (/home/asigator/fitness2025/backend/node_modules/fastify/lib/handleRequest.js:77:7)\n    at /home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:199:9\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at done (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:192:14)\n    at Parser.defaultJsonParser [as fn] (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:304:5)\n    at Request.onEnd (/home/asigator/fitness2025/backend/node_modules/fastify/lib/contentTypeParser.js:283:27)","statusCode":400,"code":"FST_ERR_VALIDATION","validation":[{"instancePath":"/target_phase","schemaPath":"#/properties/target_phase/enum","keyword":"enum","params":{"allowedValues":["mev","mav","mrv","deload"]},"message":"must be equal to one of the allowed values"}],"validationContext":"body"},"msg":"body/target_phase must be equal to one of the allowed values"}
{"level":30,"time":1759673940053,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","res":{"statusCode":400},"responseTime":2.2950680032372475,"msg":"request completed"}
{"level":30,"time":1759673940056,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 400 when manual=true but target_phase missing
            ok 1 - Returns 400 Bad Request
            ok 2 - Returns error message
            1..2
        ok 5 - should return 400 when manual=true but target_phase missing # time=2.691ms
        
{"level":30,"time":1759673940057,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","res":{"statusCode":400},"responseTime":0.9279170036315918,"msg":"request completed"}
{"level":30,"time":1759673940060,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","req":{"method":"PATCH","url":"/api/programs/1361/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 401 without authentication
            ok 1 - Returns 401 Unauthorized
            1..1
        ok 6 - should return 401 without authentication # time=2.146ms
        
{"level":30,"time":1759673940060,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","res":{"statusCode":401},"responseTime":0.7213260009884834,"msg":"request completed"}
{"level":30,"time":1759673940063,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","req":{"method":"PATCH","url":"/api/programs/99999/advance-phase","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        # Subtest: should return 404 for non-existent program
            ok 1 - Returns 404 Not Found
            ok 2 - Returns error message
            1..2
        ok 7 - should return 404 for non-existent program # time=4.216ms
        
        1..7
    ok 2 - PATCH /api/programs/:id/advance-phase # time=46.523ms
    
    # Subtest: GET /api/programs/:id/volume
        # Subtest: should return volume analysis per muscle group (200)
            ok 1 - Returns 200 OK
            ok 2 - Response has muscle_groups array
            ok 3 - At least one muscle group present
            ok 4 - Has muscle_group name
            ok 5 - Has planned_sets
            ok 6 - planned_sets is non-negative
            ok 7 - Has MEV value
            ok 8 - Has MAV value
            ok 9 - Has MRV value
            ok 10 - Has zone classification
            ok 11 - Zone is valid enum value
            ok 12 - MEV < MAV
            ok 13 - MAV < MRV
            ok 14 - Response has warnings array
            ok 15 - Warning has muscle_group
            ok 16 - Warning issue is valid enum
            ok 17 - Warning has current_volume
            ok 18 - Warning has threshold
            1..18
        ok 1 - should return volume analysis per muscle group (200) # time=32.173ms
        
        # Subtest: should classify volume zones correctly
            ok 1 - biceps: MEV ≤ planned < MAV → adequate
            ok 2 - brachialis: planned < MEV → below_mev
            ok 3 - chest: MAV ≤ planned ≤ MRV → optimal
            ok 4 - front_delts: MAV ≤ planned ≤ MRV → optimal
            ok 5 - glutes: MAV ≤ planned ≤ MRV → optimal
            ok 6 - hamstrings: MEV ≤ planned < MAV → adequate
            ok 7 - lats: MEV ≤ planned < MAV → adequate
            ok 8 - lower_back: planned < MEV → below_mev
            ok 9 - mid_back: MAV ≤ planned ≤ MRV → optimal
            ok 10 - quads: MEV ≤ planned < MAV → adequate
            ok 11 - rear_delts: MAV ≤ planned ≤ MRV → optimal
            ok 12 - side_delts: MEV ≤ planned < MAV → adequate
            ok 13 - traps: MEV ≤ planned < MAV → adequate
            ok 14 - triceps: MAV ≤ planned ≤ MRV → optimal
            1..14
        ok 2 - should classify volume zones correctly # time=10.926ms
        
        # Subtest: should generate warnings for suboptimal volume
            ok 1 - Warning count matches below_mev muscle groups
            ok 2 - Warning count matches above_mrv muscle groups
            1..2
        ok 3 - should generate warnings for suboptimal volume # time=10.29ms
        
        # Subtest: should return 401 without authentication
            ok 1 - Returns 401 Unauthorized
            1..1
        ok 4 - should return 401 without authentication # time=1.268ms
        
        # Subtest: should return 404 for non-existent program
            ok 1 - Returns 404 Not Found
            ok 2 - Returns error message
            1..2
        ok 5 - should return 404 for non-existent program # time=1.993ms
        
{"level":30,"time":1759673940065,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","res":{"statusCode":404},"responseTime":2.154616005718708,"msg":"request completed"}
{"level":30,"time":1759673940069,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940071,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","res":{"statusCode":200},"responseTime":1.7820109948515892,"msg":"request completed"}
{"level":30,"time":1759673940072,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","req":{"method":"GET","url":"/api/programs/1361/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940098,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","res":{"statusCode":200},"responseTime":26.305742003023624,"msg":"request completed"}
{"level":30,"time":1759673940105,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-g","req":{"method":"GET","url":"/api/programs/1361/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940109,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-g","res":{"statusCode":200},"responseTime":4.011220000684261,"msg":"request completed"}
{"level":30,"time":1759673940118,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-h","req":{"method":"GET","url":"/api/programs/1361/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940123,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-h","res":{"statusCode":200},"responseTime":5.51002199947834,"msg":"request completed"}
{"level":30,"time":1759673940129,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-i","req":{"method":"GET","url":"/api/programs/1361/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940129,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-i","res":{"statusCode":401},"responseTime":0.308630995452404,"msg":"request completed"}
{"level":30,"time":1759673940132,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-j","req":{"method":"GET","url":"/api/programs/99999/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940133,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-j","res":{"statusCode":404},"responseTime":0.869388997554779,"msg":"request completed"}
{"level":30,"time":1759673940136,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-k","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940507,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-k","res":{"statusCode":201},"responseTime":371.63180799782276,"msg":"request completed"}
{"level":30,"time":1759673940508,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-l","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940787,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-l","res":{"statusCode":200},"responseTime":277.90066600590944,"msg":"request completed"}
        # Subtest: should return 404 for another user's program
            ok 1 - Returns 404 Not Found (prevents data leakage)
            1..1
        ok 6 - should return 404 for another user's program # time=682.369ms
        
        1..6
    ok 3 - GET /api/programs/:id/volume # time=750.084ms
    
    1..3
ok 1 - Program Management Endpoints Contract Tests # time=1824.724ms

{"level":30,"time":1759673940787,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-m","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940801,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-m","res":{"statusCode":200},"responseTime":13.482802994549274,"msg":"request completed"}
{"level":30,"time":1759673940806,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-n","req":{"method":"GET","url":"/api/programs/1371/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759673940807,"pid":406637,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-n","res":{"statusCode":404},"responseTime":0.854373000562191,"msg":"request completed"}
1..1
Database connection closed
