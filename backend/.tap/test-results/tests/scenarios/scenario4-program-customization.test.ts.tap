TAP version 14
# Subtest: Scenario 4: Program Customization
{"level":30,"time":1759599561464,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","req":{"method":"POST","url":"/api/auth/register","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561711,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-1","res":{"statusCode":201},"responseTime":246.01493299938738,"msg":"request completed"}
{"level":30,"time":1759599561712,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","req":{"method":"POST","url":"/api/auth/login","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561925,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-2","res":{"statusCode":200},"responseTime":212.89398100040853,"msg":"request completed"}
    # Subtest: AC-1: View program exercises with details
        ok 1 - Returns 200 OK
        ok 2 - Has program_days array
        ok 3 - Has exercises array
        ok 4 - Has at least one exercise
        ok 5 - Exercise has name
        ok 6 - Exercise has target_sets
        ok 7 - Exercise has target_rep_range
        ok 8 - Exercise has target_rir
        ok 9 - Exercise has order_index
        1..9
    ok 1 - AC-1: View program exercises with details # time=8.066ms
    
    # Subtest: AC-2: Add new exercise to program day
        ok 1 - Found an exercise to add
        ok 2 - Exercise added successfully
        ok 3 - Returns program_exercise_id
        1..3
    ok 2 - AC-2: Add new exercise to program day # time=11.951ms
    
    # Subtest: AC-3 & AC-4: Volume validation on add
        ok 1 - Volume analysis retrieved
        ok 2 - Has muscle_groups array
        ok 3 - Has at least one muscle group
        ok 4 - Has planned_sets
        ok 5 - Has MEV value
        ok 6 - Has MAV value
        ok 7 - Has MRV value
        ok 8 - Has zone classification
        ok 9 - Zone is valid enum value
        ok 10 - MEV < MAV
        ok 11 - MAV < MRV
        1..11
    ok 3 - AC-3 & AC-4: Volume validation on add # time=13.276ms
    
    # Subtest: AC-5: Remove exercise from program
        ok 1 - Exercise removed successfully
        ok 2 - Deletion confirmed
        1..2
    ok 4 - AC-5: Remove exercise from program # time=4.131ms
    
    # Subtest: AC-6: Volume warning on remove if below MEV
        ok 1 - Has warnings array
        ok 2 - Warning has muscle_group
        ok 3 - Warning issue is valid enum
        ok 4 - Warning has current_volume
        ok 5 - Warning has threshold
        1..5
    ok 5 - AC-6: Volume warning on remove if below MEV # time=3.495ms
    
    # Subtest: AC-7 & AC-8: Batch reorder exercises
        ok 1 - Has at least 2 exercises to reorder
{"level":30,"time":1759599561926,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561931,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-3","res":{"statusCode":200},"responseTime":5.173769999295473,"msg":"request completed"}
{"level":30,"time":1759599561932,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561934,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-4","res":{"statusCode":200},"responseTime":1.844437001273036,"msg":"request completed"}
{"level":30,"time":1759599561943,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","req":{"method":"GET","url":"/api/exercises?muscle_group=chest","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561946,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-5","res":{"statusCode":200},"responseTime":3.126094000414014,"msg":"request completed"}
{"level":30,"time":1759599561947,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561949,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-6","res":{"statusCode":200},"responseTime":2.059129001572728,"msg":"request completed"}
{"level":30,"time":1759599561950,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","req":{"method":"POST","url":"/api/program-exercises","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561953,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-7","res":{"statusCode":201},"responseTime":3.007083998993039,"msg":"request completed"}
{"level":30,"time":1759599561956,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","req":{"method":"GET","url":"/api/programs/520/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561966,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-8","res":{"statusCode":200},"responseTime":10.54861200042069,"msg":"request completed"}
{"level":30,"time":1759599561970,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561971,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-9","res":{"statusCode":200},"responseTime":1.2426149994134903,"msg":"request completed"}
{"level":30,"time":1759599561971,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","req":{"method":"DELETE","url":"/api/program-exercises/11392","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561973,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-a","res":{"statusCode":200},"responseTime":1.3434659987688065,"msg":"request completed"}
{"level":30,"time":1759599561975,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","req":{"method":"GET","url":"/api/programs/520/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561977,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-b","res":{"statusCode":200},"responseTime":1.7061510011553764,"msg":"request completed"}
{"level":30,"time":1759599561979,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561982,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-c","res":{"statusCode":200},"responseTime":2.1258979998528957,"msg":"request completed"}
{"level":30,"time":1759599561983,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","req":{"method":"PATCH","url":"/api/program-exercises/batch-reorder","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        ok 2 - Reorder successful
        ok 3 - Reorder confirmed
        ok 4 - First exercise moved to index 1
        ok 5 - Second exercise moved to index 0
        1..5
    ok 6 - AC-7 & AC-8: Batch reorder exercises # time=8.465ms
    
    # Subtest: AC-9: Update exercise sets/reps/RIR
        ok 1 - Update successful
        ok 2 - Update confirmed
{"level":30,"time":1759599561985,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-d","res":{"statusCode":200},"responseTime":1.818665999919176,"msg":"request completed"}
{"level":30,"time":1759599561985,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561987,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-e","res":{"statusCode":200},"responseTime":1.3289390001446009,"msg":"request completed"}
{"level":30,"time":1759599561989,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599561991,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-f","res":{"statusCode":200},"responseTime":1.4140059985220432,"msg":"request completed"}
{"level":30,"time":1759599561991,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-g","req":{"method":"PATCH","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
        not ok 3 - Sets updated
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 364
            columnNumber: 7
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:364:7)
          source: |2
                const updatedExercise = afterResponse.json();
          
                t.equal(updatedExercise.target_sets, 5, 'Sets updated');
            ------^
                t.equal(updatedExercise.target_rep_range, '6-10', 'Rep range updated');
                t.equal(updatedExercise.target_rir, 1, 'RIR updated');
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -5
            +undefined
          ...
        
        not ok 4 - Rep range updated
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 365
            columnNumber: 7
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:365:7)
          source: |2
          
                t.equal(updatedExercise.target_sets, 5, 'Sets updated');
                t.equal(updatedExercise.target_rep_range, '6-10', 'Rep range updated');
            ------^
                t.equal(updatedExercise.target_rir, 1, 'RIR updated');
              });
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -6-10
            +undefined
          ...
        
        not ok 5 - RIR updated
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 366
            columnNumber: 7
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:366:7)
          source: |2
                t.equal(updatedExercise.target_sets, 5, 'Sets updated');
                t.equal(updatedExercise.target_rep_range, '6-10', 'Rep range updated');
                t.equal(updatedExercise.target_rir, 1, 'RIR updated');
            ------^
              });
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -1
            +undefined
          ...
        
        1..5
    not ok 7 - AC-9: Update exercise sets/reps/RIR # time=84.954ms
      ---
      at:
        fileName: tests/scenarios/scenario4-program-customization.test.ts
        lineNumber: 320
        columnNumber: 11
        typeName: Test
      source: |2
      
          // AC-9: Update sets/reps/RIR for existing exercise
          await t.test('AC-9: Update exercise sets/reps/RIR', async (t) => {
        ----------^
            // Get first exercise
            const programResponse = await app.inject({
      ...
    
    # Subtest: AC-10: Multi-muscle exercise volume counting
        ok 1 - Exercise works multiple muscle groups
        not ok 2 - Primary muscle group abs tracked
          ---
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 408
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:408:9)
          source: >2
                  );
          
                  t.ok(primaryMuscle, `Primary muscle group ${multiMuscleExercise.primary_muscle_group} tracked`);
            --------^
                  t.ok(primaryMuscle.planned_sets > 0, 'Primary muscle has planned sets');
          ...
        
        not ok 3 - Cannot read properties of undefined (reading 'planned_sets')
          ---
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:409:26)
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 409
            columnNumber: 26
            typeName: Test
            methodName: <anonymous>
            functionName: Test.<anonymous>
          type: TypeError
          tapCaught: returnedPromiseRejection
          source: >2
          
                  t.ok(primaryMuscle, `Primary muscle group ${multiMuscleExercise.primary_muscle_group} tracked`);
                  t.ok(primaryMuscle.planned_sets > 0, 'Primary muscle has planned sets');
            -------------------------^
          
                  // Note: Secondary muscle counting depends on implementation
          ...
        
        1..3
    not ok 8 - AC-10: Multi-muscle exercise volume counting # time=16.945ms
      ---
      at:
        fileName: tests/scenarios/scenario4-program-customization.test.ts
        lineNumber: 370
        columnNumber: 11
        typeName: Test
      source: |2
      
          // AC-10: Multi-muscle exercises count towards all muscle groups
          await t.test('AC-10: Multi-muscle exercise volume counting', async (t) => {
        ----------^
            // Find a compound exercise that works multiple muscle groups
            // (e.g., Barbell Bench Press works chest + triceps + front delts)
      ...
    
{"level":30,"time":1759599561993,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-g","res":{"statusCode":200},"responseTime":2.0294470004737377,"msg":"request completed"}
{"level":30,"time":1759599561994,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-h","req":{"method":"GET","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562039,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-h","res":{"statusCode":200},"responseTime":45.24713700078428,"msg":"request completed"}
{"level":30,"time":1759599562077,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-i","req":{"method":"GET","url":"/api/exercises?movement_pattern=compound","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562078,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-i","res":{"statusCode":200},"responseTime":1.0626339986920357,"msg":"request completed"}
{"level":30,"time":1759599562078,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-j","req":{"method":"GET","url":"/api/programs/520/volume","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562080,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-j","res":{"statusCode":200},"responseTime":1.8394089993089437,"msg":"request completed"}
{"level":30,"time":1759599562097,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-k","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562099,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-k","res":{"statusCode":200},"responseTime":1.7571350000798702,"msg":"request completed"}
{"level":30,"time":1759599562099,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-l","req":{"method":"PATCH","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
    # Subtest: AC-11: Changes persist across API calls
        not ok 1 - Call 1: Sets persisted (4)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 458
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:458:9)
          source: |2
                  const persistedExercise = checkResponse.json();
          
                  t.equal(
            --------^
                    persistedExercise.target_sets,
                    4,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -4
            +undefined
          ...
        
        not ok 2 - Call 1: RIR persisted (3)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 463
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:463:9)
          source: |2
                    `Call ${i + 1}: Sets persisted (4)`
                  );
                  t.equal(
            --------^
                    persistedExercise.target_rir,
                    3,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -3
            +undefined
          ...
        
        not ok 3 - Call 2: Sets persisted (4)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 458
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:458:9)
          source: |2
                  const persistedExercise = checkResponse.json();
          
                  t.equal(
            --------^
                    persistedExercise.target_sets,
                    4,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -4
            +undefined
          ...
        
        not ok 4 - Call 2: RIR persisted (3)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 463
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:463:9)
          source: |2
                    `Call ${i + 1}: Sets persisted (4)`
                  );
                  t.equal(
            --------^
                    persistedExercise.target_rir,
                    3,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -3
            +undefined
          ...
        
        not ok 5 - Call 3: Sets persisted (4)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 458
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:458:9)
          source: |2
                  const persistedExercise = checkResponse.json();
          
                  t.equal(
            --------^
                    persistedExercise.target_sets,
                    4,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -4
            +undefined
          ...
        
        not ok 6 - Call 3: RIR persisted (3)
          ---
          compare: ===
          at:
            fileName: tests/scenarios/scenario4-program-customization.test.ts
            lineNumber: 463
            columnNumber: 9
            typeName: Test
          stack: >
            Test.<anonymous>
            (tests/scenarios/scenario4-program-customization.test.ts:463:9)
          source: |2
                    `Call ${i + 1}: Sets persisted (4)`
                  );
                  t.equal(
            --------^
                    persistedExercise.target_rir,
                    3,
          diff: |
            --- expected
            +++ actual
            @@ -1,1 +1,1 @@
            -3
            +undefined
          ...
        
        ok 7 - Sets persisted in full program fetch
        ok 8 - RIR persisted in full program fetch
        1..8
    not ok 9 - AC-11: Changes persist across API calls # time=160.749ms
      ---
      at:
        fileName: tests/scenarios/scenario4-program-customization.test.ts
        lineNumber: 420
        columnNumber: 11
        typeName: Test
      source: |2
      
          // AC-11: Changes persist across API calls
          await t.test('AC-11: Changes persist across API calls', async (t) => {
        ----------^
            // Make a change (update an exercise)
            const programResponse = await app.inject({
      ...
    
    1..9
not ok 1 - Scenario 4: Program Customization # time=1109.01ms
  ---
  at:
    fileName: tests/scenarios/scenario4-program-customization.test.ts
    lineNumber: 24
    columnNumber: 5
    isToplevel: true
  source: |
    import buildApp from '../../src/server.js';
  
    tap.test('Scenario 4: Program Customization', async (t) => {
    ----^
      const app = await buildApp();
  ...

{"level":30,"time":1759599562102,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-l","res":{"statusCode":200},"responseTime":2.238970000296831,"msg":"request completed"}
{"level":30,"time":1759599562102,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-m","req":{"method":"GET","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562143,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-m","res":{"statusCode":200},"responseTime":41.19355100020766,"msg":"request completed"}
{"level":30,"time":1759599562153,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-n","req":{"method":"GET","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562193,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-n","res":{"statusCode":200},"responseTime":40.2582370005548,"msg":"request completed"}
{"level":30,"time":1759599562202,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-o","req":{"method":"GET","url":"/api/program-exercises/11345","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562245,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-o","res":{"statusCode":200},"responseTime":42.360178999602795,"msg":"request completed"}
{"level":30,"time":1759599562255,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-p","req":{"method":"GET","url":"/api/programs","hostname":"localhost:80","remoteAddress":"127.0.0.1"},"msg":"incoming request"}
{"level":30,"time":1759599562256,"pid":210200,"hostname":"asigator-Legion-5-17ACH6H","reqId":"req-p","res":{"statusCode":200},"responseTime":1.8023930005729198,"msg":"request completed"}
1..1
Database connection closed
